<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="CSS/CloseButton.css">
    <link rel="stylesheet" href="CSS/style.css">
    <link rel="stylesheet" href="CSS/Classes.css">
    <title>Coding-Environment</title>
</head>

<body>
    <script src="JS/firebase.js" type="module"></script>
    <div class="Container">
        <div class="LeftSide">
            <div class="code-editor">
                <pre class="highlight" aria-hidden="true"><code id="highlight"></code></pre>
                <textarea id="editor" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off"
                    placeholder="Type code here..."></textarea>
            </div>
            <textarea readonly id="Output" placeholder="Output:"></textarea>
        </div>
        <div data-include="HTML/rightSide.html"></div>
    </div>
    <div data-include="HTML/loginPage.html"></div>
    <script src="JS/includeFragments.js"></script>

    <link rel="stylesheet" href="CSS/highlighter.css">

    <script>
    (function initHighlighter(){
      function start() {
        const editor = document.getElementById('editor');
        const highlight = document.getElementById('highlight');
        if (!editor || !highlight) return; // nothing to do

        const keywords = ['set','write','incase','func','call','connect','hallo'];
        const kwPattern = '\\b(' + keywords.join('|') + ')\\b';
        const regex = new RegExp(
          [
            /("([^"\\]|\\.)*")/.source,        // double-quoted strings
            /(\/\/.*$)/.source,                // line comments
            kwPattern                          // keywords
          ].join('|'),
          'gm'
        );

        function escapeHtml(str) {
          return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
        }

        function highlightCode(text) {
          let escaped = escapeHtml(text);
          return escaped.replace(regex, (match, str, _1, comment, kw) => {
            if (str !== undefined) return '<span class="token string">' + escapeHtml(str) + '</span>';
            if (comment !== undefined) return '<span class="token comment">' + escapeHtml(comment) + '</span>';
            if (kw !== undefined) return '<span class="token keyword">' + escapeHtml(kw) + '</span>';
            return match;
          }).replace(/\n/g, '<br>').replace(/ {2}/g, '&nbsp;&nbsp;');
        }

        function syncScroll() {
          highlight.parentElement.scrollTop = editor.scrollTop;
          highlight.parentElement.scrollLeft = editor.scrollLeft;
        }

        function update() {
          const text = editor.value || '';
          highlight.innerHTML = '<code>' + highlightCode(text) + '</code>';
          syncScroll();
        }

        editor.addEventListener('input', update);
        editor.addEventListener('scroll', syncScroll);

        // initialize now (and again after includes if needed)
        update();

        // if fragments change editor content later, call update() after setting editor.value
        window.updateHighlighter = update;
      }

      // wait for DOMContentLoaded to ensure includeFragments has run
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', start);
      } else {
        start();
      }
    })();
    </script>

    <script src="JS/LoginFunctions.js"></script>
    <script src="JS/Jal.js"></script>
</body>

</html>